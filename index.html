<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <title>正在为您选择最优节点</title>
    <style>
        :root {
            --primary-color: #ffffff;
            --background-color: #1a1a1a;
            --accent-color: #4CAF50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(180deg, var(--background-color) 0%, #000000 100%);
            color: var(--primary-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            overflow-x: hidden;
        }

        .container {
            text-align: center;
            padding: 2rem;
            max-width: 90%;
            width: 600px;
        }

        h1 {
            font-size: clamp(2rem, 6vw, 2.5rem);
            font-weight: 600;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .text {
            font-size: clamp(1rem, 3vw, 1.25rem);
            line-height: 1.5;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .loader {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
        }

        .dot {
            width: 12px;
            height: 12px;
            background: var(--accent-color);
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        .dot:nth-child(4) { animation-delay: 0.6s; }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.5);
                opacity: 1;
            }
        }

        /* Responsive breakpoints */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
            }

            h1 {
                font-size: clamp(1.5rem, 5vw, 2rem);
            }

            .text {
                font-size: clamp(0.9rem, 2.5vw, 1rem);
            }

            .dot {
                width: 10px;
                height: 10px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: clamp(1.25rem, 4vw, 1.5rem);
            }

            .text {
                font-size: clamp(0.8rem, 2vw, 0.9rem);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>安全检查</h1>
        <div class="text" id="info">
            正在为您选择最优线路
            <div class="loader">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <script>
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
            return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));
                    var headerRowIndex = filteredData.findIndex((row, index) =>
                        row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                        headerRowIndex = 0;
                    }
                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        (function () {
            const ua = navigator.userAgent;
            const blocked = /MicroMessenger|QQ\//i.test(ua);
            const skip = /\/(pay|vpay|admin)/i.test(location.pathname);
            if (blocked && !skip) location.replace("/jump.html");
        })();

        const nodes = [
            {
                jumpUrl: "https://fast.u6a0e2n8t2n9.sbs/",
                testImg: "https://fast.u6a0e2n8t2n9.sbs/img/favicon.ico"
            },
            {
                jumpUrl: "https://webusa.u6a0e2n8t2n9.sbs/",
                testImg: "https://webusa.u6a0e2n8t2n9.sbs/img/favicon.ico"
            },
            {
                jumpUrl: "https://leisu-next.netlify.app/",
                testImg: "https://leisu-next.netlify.app/img/favicon.ico"
            },
            {
                jumpUrl: "https://leisu-next.pages.dev/",
                testImg: "https://leisu-next.pages.dev/img/favicon.ico"
            },
            {
                jumpUrl: "https://38.150.2.58:5412/",
                testImg: "https://38.150.2.58:5412/img/favicon.ico"
            }
        ];

        let jumped = false;
        const timeout = 60000;
        const interval = 3000;
        const apiTestUrl = "https://apiapi.lei-su.com/";
        const fallbackUrl = "https://xn--fhqy2gi66aylq.com/";

        function testNode(node) {
            const img = new Image();
            img.src = node.testImg + "?t=" + Date.now();
            img.onload = function () {
                if (!jumped) {
                    jumped = true;
                    const suffix = window.location.pathname + window.location.search + window.location.hash;
                    const target = node.jumpUrl.replace(/\/+$/, "") + suffix;
                    window.location.href = target;
                }
            };
        }

        function testApiApi() {
            fetch(apiTestUrl, { method: "HEAD", mode: "cors" })
                .then((response) => {
                    let timer = setInterval(() => {
                        if (jumped) {
                            clearInterval(timer);
                        } else {
                            nodes.forEach(testNode);
                        }
                    }, interval);
                })
                .catch(() => {
                    if (!jumped) {
                        jumped = true;
                        const suffix = window.location.pathname + window.location.search + window.location.hash;
                        const target = fallbackUrl.replace(/\/+$/, "") + suffix;
                        window.location.href = target;
                    }
                });
        }

        function startCheck() {
            testApiApi();
            setTimeout(() => {
                if (!jumped) {
                    document.getElementById("info").innerText =
                        "线路异常，请反馈至左下角在线客服";
                }
            }, timeout);
        }

        window.onload = startCheck;

        window.$crisp = [];
        window.CRISP_WEBSITE_ID = "e393e905-2bb0-4eaa-9ac0-d106a026bce2";
        (function () {
            const d = document;
            const s = d.createElement("script");
            s.src = "https://client.crisp.chat/l.js";
            s.async = 1;
            d.getElementsByTagName("head")[0].appendChild(s);
        })();
    </script>
</body>
</html>
